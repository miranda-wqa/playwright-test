# 📊 Deploy All Playwright Reports to GitHub Pages
name: 🌍 Deploy All Reports to GitHub Pages

on:
  workflow_dispatch: # 🟢 Manually triggered

jobs:
  deploy:
    name: 📂 Deploy Archived Reports
    runs-on: ubuntu-latest

    steps:
      - name: 🧑‍💻 Checkout repository
        uses: actions/checkout@v3

      - name: 🕓 Generate timestamp
        id: time
        run: echo "timestamp=$(date +'%Y-%m-%d-%H%M%S')" >> $GITHUB_OUTPUT

      - name: 📥 Download Playwright Report artifact
        uses: actions/download-artifact@v3
        with:
          name: playwright-report
          path: playwright-report

      - name: 📦 Move report to timestamped folder
        run: |
          mkdir -p reports/run-${{ steps.time.outputs.timestamp }}
          mv playwright-report/* reports/run-${{ steps.time.outputs.timestamp }}

      - name: 🚀 Deploy to GitHub Pages (preserve previous)
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: reports                     # All reports go here
          publish_branch: gh-pages
          keep_files: true                         # ✅ Keep older reports
          force_orphan: false                      # ✅ Do not wipe history
          enable_jekyll: false